# Используем официальный образ Python 3.9 в качестве базового
# Этот образ включает минимальную установку Python 3.9, что позволяет нам сэкономить место
FROM python:3.9-slim

# Устанавливаем рабочую директорию внутри контейнера
# Все последующие команды будут выполняться относительно этой директории
WORKDIR /app

# Копируем файл с зависимостями requirements.txt в контейнер
# Этот файл должен быть в том же каталоге, что и Dockerfile, и будет использоваться для установки зависимостей
COPY requirements.txt .

# Устанавливаем зависимости из файла requirements.txt
# Используем флаг --no-cache-dir для предотвращения кэширования пакетов, чтобы уменьшить размер контейнера
RUN pip install --no-cache-dir -r requirements.txt

# Создаём директорию для логов, если она отсутствует
# Это необходимо для хранения логов и предотвращения ошибок, если директория не существует
RUN mkdir -p /app/logs

# Создаём пустой файл лога, если он отсутствует
# Это файл, в который будут записываться логи работы приложения
RUN touch /app/logs/metric_log.csv

# Копируем исходный код приложения из директории ./src в контейнер
# Файлы приложения из папки src будут перенесены в рабочую директорию /app контейнера
COPY ./src /app

# Определяем команду для запуска контейнера
# При запуске контейнера будет выполнен скрипт plot.py с использованием Python
CMD ["python", "plot.py"]
