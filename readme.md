# README

## Описание проекта

Этот проект представляет собой систему микросервисов, включающую обработку данных, машинное обучение, логирование метрик и визуализацию ошибок. Все компоненты системы взаимодействуют через очередь сообщений RabbitMQ. Микросервисы контейнеризованы с помощью Docker, что позволяет легко развертывать и масштабировать систему.

### Структура проекта

Проект состоит из нескольких микросервисов, каждый из которых выполняет свою задачу. Все сервисы настроены для работы с RabbitMQ, что позволяет обмениваться данными между ними. Основная структура проекта выглядит следующим образом:

1. **Папка `features` (Микросервис для обработки данных)**
   - **Назначение**: Обработка входных данных и подготовка их для машинного обучения.
   - **Файл `features.py`**: Основной скрипт, обрабатывающий данные.
   - **Dockerfile**: Контейнеризация для выполнения микросервиса `features`.
   - **`wait-for-rabbitmq.sh`**: Скрипт, который ожидает запуска RabbitMQ перед стартом микросервиса.

2. **Папка `metrics` (Микросервис для логирования метрик)**
   - **Назначение**: Сбор и сохранение метрик предсказаний (например, абсолютных ошибок) в файл `metrics_log.csv`.
   - **Файл `metrics.py`**: Скрипт для записи метрик в лог-файл.
   - **Dockerfile**: Контейнеризация для выполнения микросервиса `metrics`.
   - **`wait-for-rabbitmq.sh`**: Скрипт ожидания доступности RabbitMQ.

3. **Папка `model` (Микросервис для выполнения предсказаний)**
   - **Назначение**: Использует предварительно обученную модель для выполнения предсказаний на основе данных из очереди `features` и отправляет результаты в очередь `y_pred`.
   - **Файл `model.py`**: Скрипт для загрузки модели и обработки данных из RabbitMQ.
   - **Модель `myfile.pkl`**: Обученная модель машинного обучения.
   - **Dockerfile**: Контейнеризация для выполнения микросервиса `model`.
   - **`wait-for-rabbitmq.sh`**: Скрипт ожидания доступности RabbitMQ.

4. **Папка `plot` (Микросервис для визуализации ошибок)**
   - **Назначение**: Генерация графиков распределения ошибок предсказаний на основе данных из `metrics_log.csv`.
   - **Файл `plot.py`**: Скрипт для создания и сохранения гистограмм ошибок.
   - **Dockerfile**: Контейнеризация для выполнения микросервиса `plot`.
   - **`wait-for-rabbitmq.sh`**: Скрипт ожидания доступности RabbitMQ.

5. **`docker-compose.yml`**
   - Файл конфигурации для запуска всех микросервисов и RabbitMQ в одном контейнеризованном окружении с помощью Docker Compose.

6. **Лог-файлы**
   - **`logs/metric_log.csv`**: Лог-файл для хранения метрик.
   - **`logs/error_distribution.png`**: График распределения ошибок предсказания.

### Технологии и инструменты

- **Python**: Основной язык разработки.
- **RabbitMQ**: Очередь сообщений для обмена данными между микросервисами.
- **Docker**: Контейнеризация всех микросервисов.
- **Matplotlib и Pandas**: Построение графиков и обработка данных.
- **Scikit-learn**: Используется для машинного обучения (в папке `model`).

### Как запустить проект

#### Предварительные требования
- Установите Docker и Docker Compose на своем компьютере.

#### Шаги для запуска

1. Клонируйте проект с удаленного репозитория:

```bash
git clone https://github.com/yourusername/yourproject.git
cd yourproject
```

2. Создайте директорию `logs` для хранения логов:

```bash
mkdir logs
```

3. Запустите проект с помощью Docker Compose:

```bash
docker-compose up
```

4. Откройте RabbitMQ Management Interface по адресу [http://localhost:15672](http://localhost:15672), чтобы отслеживать состояния очередей. Логин и пароль по умолчанию: `guest`/`guest`.

### Структура данных

#### Очередь `features`
- **ID**: Уникальный идентификатор сообщения.
- **Body**: Вектор признаков, который будет использован для выполнения предсказания.

#### Очередь `y_pred`
- **ID**: Уникальный идентификатор сообщения.
- **Body**: Предсказанное значение, возвращаемое после обработки в микросервиса `model`.

#### Лог `metrics_log.csv`
- **absolute_error**: Абсолютная ошибка предсказания.

### Основные команды

- **Сборка Docker-образа**:
  ```bash
  docker build -t <image_name> .
  ```

- **Запуск Docker-контейнера**:
  ```bash
  docker run --rm -it <image_name>
  ```

- **Мониторинг RabbitMQ**:
  ```bash
  docker logs <rabbitmq_container_name>
  ```

### Заметки
- Убедитесь, что файл модели `myfile.pkl` доступен в директории `model`.
- Логи метрик должны быть доступны для сервиса `plot`.
- Проверьте, что файл `requirements.txt` включает все необходимые зависимости для каждого сервиса.


